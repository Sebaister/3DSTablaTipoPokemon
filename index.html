<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buscador Pokémon 3DS</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      margin: 0;
      padding: 10px;
      color: #333;
      font-size: 14px;
    }
    .container {
      max-width: 320px;
      margin: 0 auto;
    }
    h1 {
      color: #e60000;
      text-align: center;
      font-size: 18px;
      margin: 5px 0;
    }
    #search {
      width: 70%;
      padding: 5px;
      font-size: 12px;
    }
    #searchBtn {
      width: 25%;
      padding: 5px;
      background: #e60000;
      color: white;
      border: none;
      font-size: 12px;
    }
    .pokemon-card {
      background: white;
      padding: 8px;
      margin-top: 10px;
      border-radius: 5px;
      text-align: center;
    }
    .pokemon-name {
      font-weight: bold;
      font-size: 16px;
      color: #e60000;
      text-transform: capitalize;
    }
    .pokemon-img {
      width: 80px;
      height: 80px;
      margin: 5px auto;
    }
    .type {
      display: inline-block;
      padding: 2px 8px;
      margin: 2px;
      border-radius: 3px;
      color: white;
      font-size: 12px;
    }
    .stat {
      margin: 3px 0;
      font-size: 12px;
    }
    .error {
      color: #e60000;
      text-align: center;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Buscador Pokémon</h1>
    <input type="text" id="search" placeholder="Nombre o número">
    <button id="searchBtn">Buscar</button>
    
    <div id="result"></div>
  </div>

  <script>
    // Colores por tipo (simplificados)
    const typeColors = {
      normal: '#A8A878', fire: '#F08030', water: '#6890F0',
      electric: '#F8D030', grass: '#78C850', ice: '#98D8D8',
      fighting: '#C03028', poison: '#A040A0', ground: '#E0C068',
      flying: '#A890F0', psychic: '#F85888', bug: '#A8B820',
      rock: '#B8A038', ghost: '#705898', dragon: '#7038F8',
      dark: '#705848', steel: '#B8B8D0', fairy: '#EE99AC'
    };

    document.getElementById('searchBtn').onclick = searchPokemon;
    document.getElementById('search').onkeypress = function(e) {
      if (e.key === 'Enter') searchPokemon();
    };

    function searchPokemon() {
      var query = document.getElementById('search').value.trim();
      if (!query) return;
      
      document.getElementById('result').innerHTML = '<p>Cargando...</p>';
      
      // Usar XMLHttpRequest (más compatible con 3DS)
      var xhr = new XMLHttpRequest();
      xhr.open('GET', 'https://proxy3ds.sebadrgn.workers.dev/pokemon/' + query.toLowerCase(), true);
      
      xhr.onload = function() {
        if (xhr.status === 200) {
          try {
            var data = JSON.parse(xhr.responseText);
            showPokemon(data);
          } catch (e) {
            showError('Datos inválidos');
          }
        } else {
          showError('Pokémon no encontrado');
        }
      };
      
      xhr.onerror = function() {
        showError('Error de conexión');
      };
      
      xhr.send();
    }

    function showPokemon(p) {
      var html = '<div class="pokemon-card">';
      
      // Nombre e ID
      html += '<div class="pokemon-name">' + 
              p.n.charAt(0).toUpperCase() + p.n.slice(1) + 
              ' <span style="color:#888;">#' + p.id + '</span></div>';
      
      // Imagen (si existe)
      if (p.img) {
        html += '<img class="pokemon-img" src="' + p.img + '" alt="' + p.n + '">';
      } else {
        html += '<div style="height:80px;line-height:80px;">No hay imagen</div>';
      }
      
      // Tipos
      if (p.t && p.t.length > 0) {
        html += '<div>';
        for (var i = 0; i < p.t.length; i++) {
          var type = p.t[i];
          html += '<span class="type" style="background:' + 
                 (typeColors[type] || '#777') + '">' + 
                 type.charAt(0).toUpperCase() + type.slice(1) + 
                 '</span>';
        }
        html += '</div>';
      }
      
      // Estadísticas
      if (p.s && p.s.length > 0) {
        html += '<div style="margin-top:8px;">';
        for (var j = 0; j < p.s.length; j++) {
          var stat = p.s[j];
          html += '<div class="stat">' + 
                  stat.n + ': ' + stat.v + 
                  '</div>';
        }
        html += '</div>';
      }
      
      html += '</div>';
      document.getElementById('result').innerHTML = html;
    }

    function showError(msg) {
      document.getElementById('result').innerHTML = 
        '<div class="error">' + msg + '</div>';
    }
  </script>
</body>
</html>
